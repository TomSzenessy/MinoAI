# `/link` Handler Spec

[Back to DocStart](../README.md)

Status:
- `implemented`
- active in `apps/web` for `test.mino.ink`, `mino.ink`, and built-in UI

Last updated:
- February 11, 2026

## Goal

Support zero-manual onboarding from setup links generated by the server:
- `https://test.mino.ink/link?serverUrl=...&apiKey=...`
- `https://mino.ink/link?serverUrl=...&apiKey=...`
- `http://localhost:3000/link?serverUrl=...&apiKey=...` (built-in UI)
- `http://localhost:5173/link?serverUrl=...&apiKey=...` (local dev)

The user should open the link and be connected automatically.

## Required Query Params

- `serverUrl`
- `apiKey`

Optional (future):
- `workspace`
- `returnTo`

## Required Behavior

1. Parse query params on `/link`.
2. Validate presence of `serverUrl` and `apiKey`.
3. Normalize `serverUrl`:
   - trim whitespace
   - remove trailing slash
4. Verify key:
   - `POST {serverUrl}/api/v1/auth/verify`
   - header: `X-Mino-Key: {apiKey}`
5. Mark setup complete:
   - `POST {serverUrl}/api/v1/auth/link`
   - header: `X-Mino-Key: {apiKey}`
6. Persist linked server profile in localStorage (`mino.linkedServers.v1`).
7. Redirect to `/workspace?profile=<id>`.

## Error Handling Requirements

- Missing params: show actionable error with retry link.
- Auth failure (`401`): show invalid key error and manual form fallback.
- Network/CORS failure: show diagnostics (`serverUrl`, endpoint attempted).
- Any failure must keep manual link form available.

## Security Requirements

- Never log raw `apiKey` to console/analytics.
- Redact key in UI logs and telemetry.
- Remove `apiKey` from browser URL after processing (replaceState).

## Acceptance Criteria

- Opening a valid `/link?serverUrl=...&apiKey=...` link performs full linking without user typing.
- Successful flow triggers `POST /api/v1/auth/link` exactly once.
- URL is cleaned immediately (`apiKey` removed via `history.replaceState`).
- Invalid links fail safely and present manual fallback.
- Behavior is identical on:
  - `https://mino.ink`
  - `https://test.mino.ink`
  - built-in UI (`http://localhost:3000`)
  - local dev client (`http://localhost:5173`)
